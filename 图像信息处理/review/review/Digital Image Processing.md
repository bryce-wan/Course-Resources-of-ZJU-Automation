## Chapter 1: Basic Concept

### 图像储存
1 byte for a pixel in a grayscale image
3 bytes for a pixel in a color image, for 3 channels respectively.

### 图片格式
代表格式：
· BMP（大部分无压缩，windows的标准图片格式，但其是支持压缩的）
· JPEG（高压缩比，支持全彩，文件小，有损压缩保存）

JPEG压缩策略：
根据压缩比要求，从高频到低频逐步削减信息（高频信息占用存储空间大，减少高频信息更容易获得高压缩比；低频信息可以保留物体的基本轮廓和色彩分布，最大限度维持图像质量;；适合用于互联网。)
缺点：不适合用于线条画、文字、图标等，其有损压缩会导致这类对象的瑕疵严重

· TIFF（LZW无损压缩，支持从高端到低端的设备可扩展性强，支持公共和私用的标记结构支持各种压缩格式，有公共软件库支持）
· GIF（LZW无损压缩，但是最多256色）
· PNG（无损压缩，支持透明背景）

编码方式： without compression, lossless compression, Lossy compression

**BMP文件结构
· 分辨率：像素数/米
· BitCount：1（二值图），4，8（灰度图），16，24（真色彩），32（带透明度通道）
· 行的字节数必须是4的整倍数，如果不是，则需要补齐。
· 一般来说，BMP文件的数据从下到上，从左到右的。**

### 成像
通过使用透镜可以会聚更多的光线到一个成像点，只是只有在特殊的位置上才能达到这个目标，即大家以前就学习过的透镜聚焦。位于合适距离的物体点可以成清晰像，其他的点则会产生弥散圆。
通过改变镜头的形状可以改变聚焦时的物体点所需要的距离。
弥散圆(circle of confusion) ：在焦点前后，光线开始聚集和扩散，点的影像变模糊，形成一个扩大的圆。如果弥散圆的直径小于人眼的鉴别能力，在一定范围内实际影像产生的模糊是不能辨认的。不能辨认的直径叫做容许弥散圆。焦点前后各有一个容许弥散圆，他们之间的距离叫做景深。景深随镜头的焦距、光圈值、拍摄距离而变化：

**镜头光圈 ：  
光圈越大，景深越小；光圈越小，景深越大；  
镜头焦距 :
镜头焦距越长，景深越小；焦距越短，景深越大；  
拍摄距离 : 
距离越远，景深越大；距离越近，景深越小。**

1. 当使用数码相机拍照时，光线经过镜头进入相机到达CCD。
2. 当CCD曝光后，光电二极管受到光线的激发而释放出电荷，生成感光元件的电信号。
3.  CCD控制芯片利用感光元件中的控制信号线路对发光二极管产生的电流进行控制，由电流传输电路输出，CCD会将一次成像产生的电信号收集起来，统一输出到放大器。
4.  经过放大和滤波后的电信号被传送到ADC，由ADC将电信号（模拟信号）转换为数字信号，数值的大小和电信号的强度与电压的高低成正比，这些数值其实也就是图像的数据。
5.  此时这些图像数据还不能直接生成图像，还要输出到DSP（数字信号处理器）中，在DSP中，将会对这些图像数据进行色彩校正、白平衡处理，并编码为数码相机所支持的图像格式、分辨率，然后才会被存储为图像文件。
6.  当完成上述步骤后，图像文件就会被保存到存储器上。

### 色彩空间

#### 色彩
色彩可以分为彩色（chromatic color）和消色（achromatic color）两大类。
彩色是指红、黄、蓝等单色以及它们的混合色。彩色物体对光谱各波长的反射具有选择性，所以它们在白光照射下呈现出不同的颜色。
消色，又称非彩色，也就是我们通常所说的灰度，是指白色，黑色以及各种深浅不同的灰色。

在视网膜上存在着三种分别对红、绿和蓝光线的波长特别敏感的视锥细胞或相应的感光色素，当不同波长的光线进入人眼时，与之相符或相近的视锥细胞发生不同程度的兴奋，于是在大脑产生相应的色觉；三种视锥细胞若受到同等程度的刺激，则产生消色。

**Perception priority and sensitivity
优先程度：同等条件下，人们往往会注意到色调（Hue, H）的变化，然后是饱和度（Saturation, S），然后是亮度（Value, V）。
敏感度：人眼对于亮度的变化最为敏感，分辨能力最强。恰好与人眼的高动态能力相匹配。**

#### 常见色彩空间：
设备有关的：RGB, CMY, HSV 
设备无关的：CIE XYZ, CIE L\*a\*b, CIE YUV

#### RGB
RBG 颜色模型是三维直角坐标颜色系统中的一个单位正方体
在正方体的主对角线上，各原色的量相等，产生由暗到亮的白色，即灰度。（0，0，0）为黑，（1，1，1）为白，正方体的其他6个角点分别为红、黄、绿、青、蓝和品红。
RGB颜色模型构成的颜色空间是CIE原色空间的一个真子集。
RGB颜色模型通常用于彩色阴极射线管和彩色光栅图形显示器（计算机和电视机采用）。
![[Pasted image 20230103214017.png]]

#### CMY
彩色印刷或者彩色打印的纸张不能发射光线，因而印刷机或打印机就只能使用一些能够吸收特定光波而反射其他光波的油墨或者颜色。
**油墨或颜料的3种基色是以红、绿、蓝三色的补色青（Cyan）、品红（Magenta）、黄（Yellow）为基色。CMY空间与RGB空间互补，也就是用白色减去RGB空间中的某一颜色值就等于同样颜色在CMY空间中的值。**
用CMY模型产生的颜色称为相减色，是因为它减掉了为视觉系统识别颜色所需要的反射光。

#### HSV
HSV（Hue，Saturation，Value）是根据颜色的直观特性由A. R. Smith在1978年创建的一种颜色空间, 也称六角锥体模型，HSV即色相H（Hue）、饱和度S（Saturation）、明度V（Value）。色相是色彩的基本属性，就是平常说的颜色的名称，如红色、黄色等，H由绕V轴的旋转角给定，红色对应于角度0°，绿色对应于角度120°，蓝色对应于角度240°，每一种颜色和它的补色相差180°；饱和度（S）是指色彩的纯度，越高色彩越纯，低则逐渐变灰；明度（V），颜色明亮的程度，明度值与发光体的光亮度有关。圆锥的顶点处，V=0，代表黑色，圆锥的顶面中心处V=1，S=0，代表白色，其空间模型如图所示。
![[Pasted image 20230103213941.png]]
**当采用RGB（或者CMY）颜色模型时，改变某一颜色的属性，比如改变色调就必须同时改变R、G、B（或者C、M、Y）三个坐标；而采用HSV颜色模型时只需改变H坐标。也就是说，HSV颜色模型中的三个坐标是独立的。符合人眼对颜色的感觉。**


#### YUV
在现代彩色电视系统中，通常采用三管彩色摄像机或彩色CCD(点耦合器件)摄像机，它把摄得的彩色图像 信号，经分色、分别放大校正得到RGB，再经过矩阵变换电路得到亮度信号Y和两个色差信号R－Y、B－Y， 最后发送端将亮度和色差三个信号分别进行编码，用同一信道发送出去。这就是我们常用的YUV色彩空间。 采用YUV色彩空间的重要性是它的亮度信号Y和色度信号U、V是分离的。如果只有Y信号分量而没有U、V分量， 那么这样表示的图就是黑白灰度图。

#### XYZ
国际照明委员会（International Commission on Illumination，CIE）为了从理论上来匹配一切色彩并以非负值表示颜色，在1931年从理论上假设了并不存在于自然界的三种原色，即理论三原色XYZ，相应的形成了XYZ颜色空间。XYZ由RGB彩色空间线性变换转换得到，变换后的空间就是CIE XYZ彩色空间，相当于使用匹配颜色的XYZ基底来代替RGB基底来表示颜色，如图所示，其中x和y两维定义颜色，第3维定义亮度。
![[Pasted image 20230103214008.png]]

#### Lab
Lab色彩模型是由亮度（L）和有关色彩的a、b三个要素组成，L表示亮度，a表示从洋红色至绿色的范围，b表示从黄色至蓝色的范围。L的值域由0到100，L=50时，就相当于50%的黑色；a和b的值域都是由+127至-128，其中当a=+127时颜色为红色，当a渐渐过渡到-128时变成绿色；同样原理，当b=+127是黄色，b=-128是蓝色，所有的颜色就以这三个值交互变化所组成。
![[Pasted image 20230103213915.png]]

## Chapter 2: Binary Image and Morphology

### 图像的二值化

#### Why Binarize？
二值化图像优点：
· 更小的内存需求
· 运行速度更快
· 为二值图像开发的算法往往可以用于灰度级图像
· 更便宜
二值化图像缺点：
· 应用范围毕竟有限；
· 更无法推广到三维空间中
· 表现力欠缺，不能表现物体内部细节
· 无法控制对比度

#### OTSU
![[Pasted image 20230103221103.png]]
1. 确定原始图像中像素的最大值和最小值；
2.  最小值加1作为threshold对原始图像进行二值化操作；
3.  根据对应关系确定前景和背景，分别计算当前threshold下的内部协方差和外部协方差；
4.  回到Step 2直到达到像素最大值；
5. 找到最大外部和最小内部协方差对应的threshold

#### Adaptive OTSU
对每个局部区域都进行OTSU

### 腐蚀与膨胀

#### Dilation
A为图像，B为结构元
由B对A膨胀所产生的二值图象D是满足以下条件的点(x,y)的集合：如果B的原点平移到点(x,y)，那么它与A的交集非空。
![[Pasted image 20230103222216.png]]
![[Pasted image 20230103222249.png]]

#### Erosion
A为图像，B为结构元
由B对A腐蚀所产生的二值图象E是满足以下条件的点(x,y)的集合：如果B的原点平移到点(x,y)，那么B将完全包含于A中。
![[Pasted image 20230103222125.png]]
![[Pasted image 20230103222336.png]]

对偶性证明：
![[Pasted image 20230103222826.png]]

### 开操作与闭操作

#### Opening
先腐蚀再膨胀
用来消除小物体、在纤细点处分离物体、平滑较大物体的边界的同时并不明显改变其面积。

#### Closing
先膨胀再腐蚀
用来填充物体内细小空洞、连接邻近物体、平滑其边界的同时并不明显改变其面积。


## Chapter 3: Grayscale Image Transform

### 图像增强

#### 对数增强
![[Pasted image 20230103223742.png]]

### 直方图均衡化
灰度直方图就是把一张图中的几何特征抹去，以图像的灰度特征分等级统计后绘制的柱状图。注意满足归一化条件。
**直方图均衡化：将原图像的非均匀分布的直方图通过变换函数T修正为均匀分布的直方图，然后按均衡直方图修正原图像。图像均衡化处理后，图像的直方图是平直的，即各灰度级具有相同的出现频数。**
原则：转换函数T在变量r处的函数值s，是原直方图中灰度等级为[0,r]以内的直方图曲线所覆盖的面积。
![[Pasted image 20230103224622.png]]
![[Pasted image 20230103225115.png]]
![[Pasted image 20230103225124.png]]

直方图均衡化实质上是减少图像的灰度级以换取对比度的加大。在均衡过程中，原来的直方图上出现概率较小的灰度级被归入很少几个甚至一个灰度级中，故得不到增强。若这些灰度级所构成的图象细节比较重要，则需采用局部区域直方图均衡化处理。

## Chapter 4: Geometric Transform

### 简单的几何变换
平移变换
旋转变换
镜像变换
缩放变换
错切变换

### 插值

#### 最近邻插值
输出像素的灰度值等于离它所映射到的位置最近的输入像素的灰度值。

#### 线性插值
一维情况：
![[Pasted image 20230103235157.png]]

二维情况：
![[Pasted image 20230103235237.png]]

#### RBF插值
选择不同的径向基函数作为权重
![[Pasted image 20230104000041.png]]

## Chapter 5: Image Morph
Morph变形指景物的形体变化，它是使一幅图像逐步变化到另一幅图像的处理方法。这是一种较复杂的二维图像处理，需要对各像素点的颜色、位置作变换。变形的起始图像和结束图像分别为两幅关键帧，从起始形状变化到结束形状的关键在于自动地生成中间形状，也即自动生成中间帧。

### Static Morph
大小相同的两幅图的转换作静态变换。从一幅图a逐渐变化成第二幅图b。

原理：让图a中每个像素的颜色，逐渐变成图b相同位置像素的颜色。

方法：根据变换的快慢，设置相应的步长，将图a每一点的RGB逐渐变成图b相同位置象素的RGB。可以选择等比或等差的方式，或其它方式让：ra->rb。
![[Pasted image 20230104000219.png]]
对于灰度图像，可以直接用等比或等差级数定义步长，使颜色从原图变到目标图。
对于彩色图像，RGB三色同时从原图变到目标图像。可以分别变化，也可考虑RGB的相对比例关系同时变化。

## Chapter 6: Image Convolution

### 1D Convolution
Continuous 1D convolution
![[Pasted image 20230104000453.png]]
Discrete 1D convolution
![[Pasted image 20230104000655.png]]

Example
![[Pasted image 20230104000853.png]]
![[Pasted image 20230104000902.png]]
![[Pasted image 20230104000909.png]]
![[Pasted image 20230104000917.png]]

## Chapter 7: Image Filtering

![[Pasted image 20230104001252.png]]
滤波掩模的大小与图像的平滑效果有直接的关系。当掩模比较小时，可以观察到在整幅图像中有轻微的模糊，当掩模大小增加，模糊程度也随之增加。

### Mean Filtering
均值滤波
![[Pasted image 20230104001201.png]]

### Weighted Mean Filtering
带权均值滤波
![[Pasted image 20230104001236.png]]

### Median Filtering
(基于统计，属于Statical Sorting Filter 的一种)
· 用像素邻域内灰度的中值代替该像素的值。
· 提供了优秀的去噪能力，比小尺寸的线性平滑滤波器的模糊程度明显要低。
· 对处理脉冲噪声（也称为椒盐噪声）非常有效，因为这种噪声是以黑白点叠加在图像上的。

排序后用中值进行取代。

### Laplacian Filtering
注意符号
保有旋转不变性
![[Pasted image 20230104001841.png]]
![[Pasted image 20230104001850.png]]
将对角线元素也引入后：
![[Pasted image 20230104001924.png]]

### Bilateral Filtering
![[Pasted image 20230104212045.png]]
![[Pasted image 20230104212056.png]]
值得注意的是，在高斯滤波中，相比于标准差小的时候，标准差增大会使得距离中心远的点的权重增加，这一性质由高斯函数决定：当标准差减小时，高斯函数的图像会变得更加平坦。而在双边滤波中，不论是空间标准差还是相似标准差，其增大时，同样在空间域或者值域上体现出相似效果，即标准差越大，与中心点距离远（不相似）的点的权重越大。

同时，方差越大，说明权重差别越小，因此表示不强调这一因素的影响，反之，则表示更强调这一因素导致的权重的不均衡。因此两个方面的某个的方差相对变小 表示这一方面相对较重要，得到强调。如sigma_s变小，表示更多采用近邻的值作平滑，说明图像的空间信息更重要，即相近相似。如sigma_r变小，表示和自己同一类的条件变得苛刻，从而强调值域的相似性。而如果sigma_r​趋向无限大，则双边滤波退化为高斯滤波。

![[Pasted image 20230104212127.png]]

缺点：非线性，复杂，计算量大，不能预先计算，计算慢

### Guided Filtering
相对于双边滤波有更好的边缘保持特性，且不会出现梯度反转现象。在不同引导图像的引导下，可广泛应用于降噪、去雾、高动态范围压缩等

![[Pasted image 20230104221030.png]]

对于位置i的像素$q_i$，得到的滤波输出是一个加权之后的结果：
$$q_i=\sum_j W_{ij}p_j$$
其中i，j都是像素的下标。W_ij是引导图像I相关的滤波器。
导向滤波假设输出图像q与引导图像在滤波窗口w_k上存在线性关系。即：
$$q_i=a_kI_i+b_k, \forall i \in w_k $$
对于一个以r为半径确定的窗口w_k，(a_k, b_k)确定了这个局部区域的线性化表达。对于相邻的像素点而言，存在：
$$∇ q = a ∇ I $$
因此只要求解得到了系数也就得到了输出q。我们认为输入图像中非边缘区域又不平滑的地方视为噪声n，从而有如下关系：
$$q_i=p_i-n_i$$
最小化噪声函数：
$$min \sum_{i \in w_k}(q_i-p_i)^2$$
即：
$$min \sum_{i \in w_k}(a_kI_i+b_k-p_i)^2$$
为了防止a_k过大，我们引入正则化参数epsilon，最终得到损失函数：
$$Loss=E(a_k,b_k)=\sum_{i \in w_k}[(a_kI_i+b_k-p_i)^2+ \epsilon a_k^2]$$
求解最优化参数：
$$\frac{\delta E}{\delta a_k}=\sum_{i \in w_k}[2(a_kI_i+b_k-p_i)(I_i)+2\epsilon a_k]=0$$
$$\frac{\delta E}{\delta b_k}=\sum_{i \in w_k}[2(a_kI_i+b_k-p_i)]=0$$
从而得到结果：
$$a=\frac{cov(I,p)}{var(I)+\epsilon} ,b=\overline p-a\overline I$$
目标图像：
$$q_i=\frac{1}{|\omega|}\sum_{k|i \in w_k}(a_kI_i+b_k)=\overline a_iI_i+\overline b_i$$
特别地，当I=p的时候，算法变成一个边缘保持的滤波器：
$$a=\frac{var(I)}{var(I)+\epsilon} ,b=(1-a)\overline I$$
此时epsilon变成了界定平滑区域和边缘区域的阈值。
Case1：相对平滑区域，方差项远小于epsilon，a≈0，b≈p，相当于均值滤波结果。
Case2：边缘区域，方差项很大，a≈1，b≈0，保持原有梯度。

## Chapter 8: FT

### FFT
将原始的N点序列依次分解为一系列短序列；求出这些短序列的离散傅立叶变换；组合出所需的变换值。

### DFT
相位和幅度哪个更重要？
![[Pasted image 20230104222446.png]]


## Chapter 9: Image Feature Extraction

### Harris Corner Detection
角点是二维图像亮度变化剧烈的点，或者是两条线的交叉处。考察某个点是否为角点，在该像素周围设置一个滑动窗口，计算滑动后的SSD。我们这里让窗口从W沿着向量（u，v）移动。
![[Pasted image 20230105114450.png]]
![[Pasted image 20230105114524.png]]
![[Pasted image 20230105131245.png]]
![[Pasted image 20230105131432.png]]
![[Pasted image 20230105131440.png]]
![[Pasted image 20230105131343.png]]
![[Pasted image 20230105131352.png]]
通常用下面表达式对角点响应进行度量：
![[Pasted image 20230105131516.png]]
其中矩阵M是实对称矩阵，那么E表达式其实就是二次型，U,V代表窗口滑动方向以及滑动量，E代表灰度变化，通过矩阵M进行特征值求解，而特征值所对应的特征向量即为灰度变化方向。如果两个特征值较大，则表示有两个方向灰度变化较快。所以可以直接通过求解M的特征值进行角点判断。

根据上述的讨论，我们总结出Harris角点算法的基本步骤：
1. 计算窗口中各像素点在x和y方向的梯度；
2. 计算两个方向梯度的乘积,即Ix ^ 2 , Iy ^ 2 , IxIy(可以用一些一阶梯度算子求得图像梯度)
3. 使用滤波核对窗口中的每一像素进行加权，生成矩阵M和元素A，B，C
4. 计算每个像素的Harris响应值R，并对小于某阈值T的R置0；
5. 由于角点所在区域的一定邻域内都有可能被检测为角点，所以为了防止角点聚集，最后在3×3或5×5的邻域内进行非极大值抑制，局部最大值点即为图像中的角点。


![[Pasted image 20230105132629.png]]

### Harris-Laplacian
Harris-Laplace算法的基本思路很简单：
1. 首先预设一组尺度（高斯函数的方差），在每个尺度下进行Harris检测
2. 对当前图像，生成一组不同尺度下的图像集
3. 对step 1中找到的每个角点，在step 2中相同位置下比较其26个邻域的LOG相应值，如果也为局部极大值，则认为该点为最终角点。

### SIFT
![[Pasted image 20230105153504.png]]
基本步骤：
1. 寻找特征点
2. 在每个特征点周围的邻域内，在选定的尺度上计算每个像素处的梯度（边缘方向）。
3. 抛弃梯度比较小/边缘特征弱的点。
4. 为剩下来的点建立直方图对方向特征进行统计。
5. 将区域划分为4x4的子块，对每一个子块进行8个方向的直方图统计操作，获得每个方向的梯度幅值，总共可以组成128维描述向量。
![[Pasted image 20230105152126.png]]
![[Pasted image 20230105153153.png]]

### SURF
SURF(Speeded Up Robust Features) 是对SIFT的一种改进，主要特点是快速。SURF与SIFT主要有以下几点不同：
1. SIFT在构造DOG金字塔以及求DOG局部空间极值比较耗时，SURF的改进是使用Hessian矩阵变换图像，极值的检测只需计算Hessian矩阵行列式，作为进一步优化，使用一个简单的方程可以求出Hessian行列式近似值，使用盒状模糊滤波（box blur）求高斯模糊近似值。
2. SURF不使用降采样，通过保持图像大小不变，但改变盒状滤波器的大小来构建尺度金字塔。
3. 在计算关键点主方向以及关键点周边像素方向的方法上，SURF不使用直方图统计，而是使用哈尔(harr)小波转换。SIFT的KPD达到128维，导致KPD的比较耗时，SURF使用哈尔(haar)小波转换得到的方向，让SURF的KPD降到64维，减少了一半，提高了匹配速度。
![[Pasted image 20230105155245.png]]
![[Pasted image 20230105155416.png]]

SURF可以用于加速特征提取，SIFT特征不好算条纹类型，以及灰度值渐变的类型，SURF都可以计算，SIFT在计算有噪声时可能受到干扰，SURF抗干扰能力更强。

### RANSAC
RANSAC算法的基本假设是样本中包含正确数据(inliers，可以被模型描述的数据)，也包含异常数据(outliers，偏离正常范围很远、无法适应数学模型的数据)，即数据集中含有噪声。这些异常数据可能是由于错误的测量、错误的假设、错误的计算等产生的。同时RANSAC也假设，给定一组正确的数据，存在可以计算出符合这些数据的模型参数的方法。

数据分两种：有效数据（inliers）和无效数据（outliers）。偏差不大的数据称为有效数据，偏差大的数据是无效数据。如果有效数据占大多数，无效数据只是少量时，我们可以通过最小二乘法或类似的方法来确定模型的参数和误差；如果无效数据很多（比如超过了50%的数据都是无效数据），最小二乘法就失效了，我们需要新的算法

1. 在数据中随机选择几个点设定为内群
2. 计算适合内群的模型
3. 把其他刚才没有选到的点带入刚才建立的模型中，计算是否为内群
4. 记下内群数量
5. 重复以上步骤多次
6. 比较哪次计算中内群数量最多，内群最多的那次所建的模型就是我们所要求的解

![[Pasted image 20230105160314.png]]
![[Pasted image 20230105160455.png]]

图片拼接的一般步骤：
![[Pasted image 20230105160537.png]]
## Chapter 10: CNN

### BP
![[Pasted image 20230105165456.png]]

引⼊CNN可以通过局部连接、权值共享、池化⼤规模减少权数参数训练量

### 池化
CNN池化可以通过池化层来降低卷积层输出的特征维度，在有效减少⽹络参数的同时还可以防 ⽌过拟合现象。找到不同特征，降低数据规模。

### 学习率
过大->不稳定，发散，难以收敛
过小->收敛速度慢，容易陷入局部极值

解决方案：
1. 多次尝试
2. 自适应学习率


### 正则化
1. Dropout
2. 早停机制